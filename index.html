<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>USDTZBEP20 Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 1000px; margin: 2em auto; padding: 1em; background: #f8f8f8; }
  h1 { color: #0f9d58; text-align:center; } /* verde per titoli */
  .section { background: #f0f0f0; padding: 1em; border-radius: 8px; margin-bottom: 2em; }
  input, button { padding: 0.5em; margin-right: 0.5em; }
  button { cursor: pointer; background:#0f9d58; color:#fff; border:none; border-radius:5px; }
  canvas { background: #fff; border: 1px solid #ccc; border-radius: 8px; margin-top: 1em; }
  ul { padding-left: 1.2em; }
  li { margin-bottom: 0.3em; }
  header { text-align: center; margin-bottom: 2em; }
  header img { width:100px; border-radius:50%; border:2px solid gold; }
  .pool { font-size: 0.9em; color:#555; } /* pool discreta */
</style>
</head>
<body>

<header>
  <img src="images/logo.png" alt="USDT.z Logo">
  <h1>USDTZBEP20 (USDT.z)</h1>
</header>

<div class="section" id="token-info">
  <h2>Informazioni Token</h2>
  <p>Wallet connesso: <span id="wallet">nessuno</span></p>
  <p>Balance: <span id="balance">loading...</span></p>
  <p>Supply totale: <span id="supply">100,000,000</span></p>
  <p class="pool">Pool attiva: sì (piccola, discreta)</p>
  <button id="connect">Connect Wallet</button>
</div>

<div class="section" id="transaction">
  <h2>Invia Token</h2>
  <input type="text" id="to" placeholder="Indirizzo destinatario">
  <input type="number" id="amount" placeholder="Quantità">
  <button id="send">Invia</button>
</div>

<div class="section" id="charts">
  <h2>Grafici Token</h2>
  <canvas id="tokenChart" width="900" height="400"></canvas>
  <canvas id="balanceChart" width="900" height="400"></canvas>
</div>

<div class="section" id="events">
  <h2>Ultimi eventi Transfer</h2>
  <ul id="eventList"><li>Loading...</li></ul>
</div>

<div class="section" id="marketing">
  <h2>Perché scegliere USDT.z?</h2>
  <ul>
    <li>Token indipendente e sicuro su BNB Smart Chain</li>
    <li>Trasparenza totale su supply e balance</li>
    <li>Compatibile con MetaMask</li>
    <li>Perfetto per pool, trading e staking</li>
  </ul>
  <h3>Risorse utili</h3>
  <p>
    <a href="https://bscscan.com/token/0x3c71DA139181B5801A9390c08a1C30c7B07D54aa" target="_blank">Explorer BSC</a>
  </p>
  <p>Segui i nostri aggiornamenti su <a href="#">LinkedIn</a> e <a href="#">Facebook</a></p>
</div>

<script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// ---------------------------------------------
// CONFIGURAZIONE
// ---------------------------------------------
const ethContractAddress = "0x3c71DA139181B5801A9390c08a1C30c7B07D54aa"; 
const contractABI = [ /* ABI minima: totalSupply, balanceOf, transfer, Transfer events */ ];

let user = null;
let network = "BSC";
let contract = null;

let tokenChart, balanceChart;
const maxPoints = 20;

// ---------------------------------------------
// GRAFICI
// ---------------------------------------------
function initCharts() {
  const ctx1 = document.getElementById('tokenChart').getContext('2d');
  tokenChart = new Chart(ctx1, { type: 'line', data: { labels: [], datasets:[{label:'Supply Totale', data:[], borderColor:'#0f9d58', fill:false}] }, options:{responsive:true, animation:{duration:500,easing:'easeOutQuad'}} });

  const ctx2 = document.getElementById('balanceChart').getContext('2d');
  balanceChart = new Chart(ctx2, { type: 'line', data: { labels: [], datasets:[{label:'Balance Utente', data:[], borderColor:'#1a73e8', fill:false}] }, options:{responsive:true, animation:{duration:500,easing:'easeOutQuad'}} });
}

function addData(chart,label,value){
  chart.data.labels.push(label);
  chart.data.datasets[0].data.push(value);
  if(chart.data.labels.length>maxPoints){ chart.data.labels.shift(); chart.data.datasets[0].data.shift(); }
  chart.update();
}

// ---------------------------------------------
// BALANCE E GRAFICI
// ---------------------------------------------
async function updateBalance(){
  if(!user || !contract) return;
  const bal = await contract.methods.balanceOf(user).call();
  const supply = await contract.methods.totalSupply().call();

  document.getElementById("balance").innerText = bal;
  document.getElementById("supply").innerText = supply;

  const ts = new Date().toLocaleTimeString();
  addData(tokenChart, ts, supply);
  addData(balanceChart, ts, bal);
}

// ---------------------------------------------
// EVENTI
// ---------------------------------------------
async function fetchEvents(){
  const eventList=document.getElementById("eventList");
  eventList.innerHTML='';
  const events = await contract.getPastEvents('Transfer',{fromBlock:0,toBlock:'latest'});
  events.slice(-5).reverse().forEach(e=>{
    const li=document.createElement('li');
    li.innerText=`Da ${e.returnValues.from} a ${e.returnValues.to}: ${e.returnValues.value}`;
    eventList.appendChild(li);
  });
}

// ---------------------------------------------
// WALLET
// ---------------------------------------------
async function connectWallet(){
  if(window.ethereum){
    const accounts = await window.ethereum.request({method:'eth_requestAccounts'});
    user = accounts[0];
    const web3 = new Web3(window.ethereum);
    contract = new web3.eth.Contract(contractABI, ethContractAddress);
  }else{ alert("Installa MetaMask"); return; }
  document.getElementById("wallet").innerText=user+" (BNB Smart Chain)";
  updateBalance();
  fetchEvents();
  setInterval(updateBalance,10000);
  setInterval(fetchEvents,15000);
}

// ---------------------------------------------
// INVIO TOKEN
// ---------------------------------------------
async function sendToken(){
  const to=document.getElementById("to").value;
  const amount=document.getElementById("amount").value;
  if(!to||!amount){ alert("Compila tutti i campi"); return; }
  try{
    const tx=await contract.methods.transfer(to,amount).send({from:user});
    alert("Transazione inviata: "+tx.transactionHash);
    updateBalance();
    fetchEvents();
  }catch(e){ alert("Errore: "+e); }
}

// ---------------------------------------------
// EVENT LISTENER
// ---------------------------------------------
document.getElementById("connect").onclick=connectWallet;
document.getElementById("send").onclick=sendToken;
window.onload=initCharts;

</script>
</body>
</html>
